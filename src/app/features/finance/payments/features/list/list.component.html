<div class="grid">
    <div class="col-12">
        <div class="card">
            <div class="flex flex-column md:flex-row justify-content-between align-items-start gap-3">
                <div>
                    <h2 class="m-0">Pagamentos</h2>
                    <span class="text-600">Vista geral de pagamentos</span>
                </div>
                <div class="flex gap-2">
                    <button pButton type="button" label="Relatórios" icon="pi pi-chart-bar" class="p-button-outlined"
                            [routerLink]="['/schoolar/payments/reports']"></button>
                    <button pButton type="button" label="Novo pagamento" icon="pi pi-plus"
                            [routerLink]="['/finances/payments/create']"></button>
                </div>
            </div>

            <div class="mt-3">
                <p-selectButton [options]="[
          {label: 'Todos', value: 'all'},
          {label: 'Pendentes', value: 'PENDING_PAYMENT'},
          {label: 'Pagos', value: 'PAID'},
          {label: 'Vencidos', value: 'OVERDUE'},
          {label: 'Cancelado', value: 'CANCELLED'}
        ]" [(ngModel)]="statusFilter" (onChange)="applyFilters()"></p-selectButton>
            </div>

            <div class="grid mt-3">
                <div class="col-12 md:col-3">
                    <div class="surface-100 p-3 border-round">
                        <div class="text-600">Total de pagamentos</div>
                        <div class="text-3xl font-bold">{{ totalInstallments }}</div>
                    </div>
                </div>
                <div class="col-12 md:col-3">
                    <div class="surface-100 p-3 border-round">
                        <div class="text-600">Pagos</div>
                        <div class="text-3xl font-bold text-green-600">{{ paidInstallments }}</div>
                    </div>
                </div>
                <div class="col-12 md:col-3">
                    <div class="surface-100 p-3 border-round">
                        <div class="text-600">Pendentes</div>
                        <div class="text-3xl font-bold text-yellow-600">{{ pendingInstallments }}</div>
                    </div>
                </div>
                <div class="col-12 md:col-3">
                    <div class="surface-100 p-3 border-round">
                        <div class="text-600">Vencidos</div>
                        <div class="text-3xl font-bold text-red-600">{{ overdueInstallments }}</div>
                    </div>
                </div>
            </div>

            <p-table [value]="filteredInstallments" [paginator]="true" [rows]="size"
                     [rowsPerPageOptions]="[10,15,25,50]" [lazy]="true" [totalRecords]="totalRecords"
                     [loading]="(loading$ | async)!" (onPage)="onPageChange($event)" responsiveLayout="scroll">
                <ng-template pTemplate="header">
                    <tr>
                        <th>Contrato</th>
                        <th>Valor</th>
                        <th>Data de vencimento</th>
                        <th>Parcela</th>
                        <th>Estado</th>
                        <th>Acções</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-installment>
                    <tr>
                        <td>
                            <a [routerLink]="['/finances/contracts/details', installment.contract.id]"
                               class="text-primary">
                                {{ installment.contract.student.code }}
                            </a>
                        </td>
                        <td>{{ installment.amount + ' Kz' }}</td>
                        <td>{{ installment.dueDate | date:'shortDate' }}</td>
                        <td>{{ installment.installmentNumber }}</td>
                        <td>
                            <p-tag [value]="installment.status"
                                   [severity]="getStatusSeverity(installment.status)"></p-tag>
                        </td>
                        <td class="flex gap-2">
                            <button *ngIf="installment.status !== 'PAID'" pButton type="button" icon="pi pi-check"
                                    class="p-button-success p-button-sm" (click)="markAsPaid(installment)"
                                    pTooltip="Fazer pagamento"></button>
                            <button pButton type="button" icon="pi pi-eye" class="p-button-info p-button-sm"
                                    [routerLink]="['/finances/contracts/details', installment.contract.id]"
                                    pTooltip="Ver Contrato"></button>
                        </td>
                    </tr>
                </ng-template>
            </p-table>

        </div>
    </div>
</div>
