<div class="grid">
    <div class="col-12">
        <div class="card">
            <h5>Criar Novo Funcionário</h5>
            <form [formGroup]="employeeForm" (ngSubmit)="onSubmit()">
                <div class="p-fluid p-formgrid grid">
                    <!-- User Information -->
                    <div class="col-12 md:col-6" formGroupName="user">
                        <div class="card">
                            <h5>Informações do Usuário</h5>
                            <div class="field">
                                <label for="firstname">Nome</label>
                                <input id="firstname" type="text" pInputText formControlName="firstname" />
                                <small *ngIf="employeeForm.get('user.firstname')?.invalid && employeeForm.get('user.firstname')?.touched" class="p-error">
                                    Nome é obrigatório
                                </small>
                            </div>
                            <div class="field">
                                <label for="lastname">Sobrenome</label>
                                <input id="lastname" type="text" pInputText formControlName="lastname" />
                                <small *ngIf="employeeForm.get('user.lastname')?.invalid && employeeForm.get('user.lastname')?.touched" class="p-error">
                                    Sobrenome é obrigatório
                                </small>
                            </div>
                            <div class="field">
                                <label>Gênero</label>
                                <div class="grid">
                                    <div class="col-4" *ngFor="let gender of genderOptions">
                                        <div class="field-radiobutton">
                                            <p-radioButton [inputId]="gender.value" [value]="gender.value" formControlName="gender"></p-radioButton>
                                            <label [for]="gender.value">{{gender.label}}</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="field">
                                <label for="dateOfBirth">Data de Nascimento</label>
                                <p-calendar id="dateOfBirth" formControlName="dateOfBirth" [showIcon]="true" dateFormat="dd/mm/yy"></p-calendar>
                                <small *ngIf="employeeForm.get('user.dateOfBirth')?.invalid && employeeForm.get('user.dateOfBirth')?.touched" class="p-error">
                                    Data de nascimento é obrigatória
                                </small>
                            </div>
                            <div class="field">
                                <label for="email">Email</label>
                                <input id="email" type="email" pInputText formControlName="email" />
                                <small *ngIf="employeeForm.get('user.email')?.invalid && employeeForm.get('user.email')?.touched" class="p-error">
                                    Email válido é obrigatório
                                </small>
                            </div>
                            <div class="field">
                                <label for="password">Senha</label>
                                <p-password id="password" formControlName="password" [toggleMask]="true" [feedback]="true"></p-password>
                                <small *ngIf="employeeForm.get('user.password')?.invalid && employeeForm.get('user.password')?.touched" class="p-error">
                                    Senha é obrigatória (mínimo 8 caracteres)
                                </small>
                            </div>
                            <div class="field">
                                <label for="photo">URL da Foto</label>
                                <input id="photo" type="text" pInputText formControlName="photo" />
                            </div>
                        </div>
                    </div>

                    <!-- Employment Information -->
                    <div class="col-12 md:col-6">
                        <div class="card">
                            <h5>Informações Profissionais</h5>
                            <div class="field" formGroupName="user">
                                <label for="roleId">Função Principal</label>
                                <p-dropdown id="roleId" [options]="roles" formControlName="roleId" placeholder="Selecione uma função" optionLabel="name" optionValue="id"></p-dropdown>
                                <small *ngIf="employeeForm.get('user.roleId')?.invalid && employeeForm.get('user.roleId')?.touched" class="p-error">
                                    Função é obrigatória
                                </small>
                            </div>
                            <div class="field" formGroupName="user">
                                <label for="additionalPermissionIds">Permissões</label>
                                <p-tree
                                    [value]="permissionTree"
                                    selectionMode="checkbox"
                                    [(selection)]="selectedPermissions"
                                    (onNodeSelect)="onPermissionNodeSelect($event)"
                                    (onNodeUnselect)="onPermissionNodeUnselect($event)"
                                    styleClass="w-full">
                                </p-tree>
                                <small class="text-xs text-gray-500 mt-1">
                                    Selecione uma função para carregar suas permissões. Você pode desmarcar ou adicionar permissões conforme necessário.
                                </small>
                            </div>
                            <div class="field">
                                <label for="centerId">Centro</label>
                                <input id="centerId" type="text" pInputText formControlName="centerId" />
                                <small *ngIf="employeeForm.get('centerId')?.invalid && employeeForm.get('centerId')?.touched" class="p-error">
                                    Centro é obrigatório
                                </small>
                            </div>
                            <div class="field">
                                <label for="hiringDate">Data de Contratação</label>
                                <p-calendar id="hiringDate" formControlName="hiringDate" [showIcon]="true" dateFormat="dd/mm/yy"></p-calendar>
                                <small *ngIf="employeeForm.get('hiringDate')?.invalid && employeeForm.get('hiringDate')?.touched" class="p-error">
                                    Data de contratação é obrigatória
                                </small>
                            </div>
                            <div class="field">
                                <label for="wage">Salário</label>
                                <p-inputNumber id="wage" formControlName="wage" mode="currency" currency="BRL" locale="pt-BR"></p-inputNumber>
                                <small *ngIf="employeeForm.get('wage')?.invalid && employeeForm.get('wage')?.touched" class="p-error">
                                    Salário é obrigatório
                                </small>
                            </div>
                            <div class="field">
                                <label for="status">Status</label>
                                <p-dropdown id="status" [options]="statusOptions" formControlName="status" placeholder="Selecione um status" optionLabel="label" optionValue="value"></p-dropdown>
                                <small *ngIf="employeeForm.get('status')?.invalid && employeeForm.get('status')?.touched" class="p-error">
                                    Status é obrigatório
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- Buttons -->
                    <div class="col-12">
                        <div class="flex justify-content-end">
                            <button pButton pRipple label="Cancelar" icon="pi pi-times" class="p-button-text" (click)="cancel()"></button>
                            <button pButton pRipple label="Salvar" icon="pi pi-check" class="p-button-primary" type="submit" [disabled]="employeeForm.invalid || loading"></button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
