<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Payment Installments</h1>
    <a routerLink="/payments/installments/create" class="btn btn-primary">Create Installment Plan</a>
  </div>

  <!-- Filter Buttons -->
  <div class="btn-group mb-4">
    <button
      class="btn"
      [class.btn-primary]="statusFilter === 'all'"
      [class.btn-outline-primary]="statusFilter !== 'all'"
      (click)="filterByStatus('all')">
      All
    </button>
    <button
      class="btn"
      [class.btn-warning]="statusFilter === 'pending'"
      [class.btn-outline-warning]="statusFilter !== 'pending'"
      (click)="filterByStatus('pending')">
      Pending
    </button>
    <button
      class="btn"
      [class.btn-success]="statusFilter === 'paid'"
      [class.btn-outline-success]="statusFilter !== 'paid'"
      (click)="filterByStatus('paid')">
      Paid
    </button>
    <button
      class="btn"
      [class.btn-danger]="statusFilter === 'overdue'"
      [class.btn-outline-danger]="statusFilter !== 'overdue'"
      (click)="filterByStatus('overdue')">
      Overdue
    </button>
  </div>

  <!-- Installments Table -->
  <div class="card">
    <div class="card-body">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>ID</th>
            <th>Payment ID</th>
            <th>Amount</th>
            <th>Due Date</th>
            <th>Payment Date</th>
            <th>Installment</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let installment of filteredInstallments">
            <td>{{ installment.id }}</td>
            <td>
              <a [routerLink]="['/payments/installments/detail', installment.payment_id]">
                {{ installment.payment_id }}
              </a>
            </td>
            <td>${{ installment.amount.toFixed(2) }}</td>
            <td>{{ installment.due_date | date:'shortDate' }}</td>
            <td>{{ installment.payment_date ? (installment.payment_date | date:'shortDate') : '-' }}</td>
            <td>{{ installment.number }}/{{ installment.total_installments }}</td>
            <td>
              <span class="badge"
                [class.bg-success]="installment.status === 'paid'"
                [class.bg-warning]="installment.status === 'pending'"
                [class.bg-danger]="installment.status === 'overdue'"
                [class.bg-secondary]="installment.status === 'cancelled'">
                {{ installment.status | titlecase }}
              </span>
            </td>
            <td>
              <button
                *ngIf="installment.status !== 'paid'"
                class="btn btn-sm btn-success me-2"
                (click)="markAsPaid(installment)">
                Mark as Paid
              </button>
              <a
                [routerLink]="['/payments/installments/detail', installment.payment_id]"
                class="btn btn-sm btn-info">
                View Details
              </a>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Summary -->
  <div class="card mt-4">
    <div class="card-header">
      <h5>Summary</h5>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-3">
          <div class="card bg-light">
            <div class="card-body text-center">
              <h6>Total Installments</h6>
              <h3>{{ totalInstallments }}</h3>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-success text-white">
            <div class="card-body text-center">
              <h6>Paid</h6>
              <h3>{{ paidInstallments }}</h3>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-warning text-white">
            <div class="card-body text-center">
              <h6>Pending</h6>
              <h3>{{ pendingInstallments }}</h3>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-danger text-white">
            <div class="card-body text-center">
              <h6>Overdue</h6>
              <h3>{{ overdueInstallments }}</h3>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
