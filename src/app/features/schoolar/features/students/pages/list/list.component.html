<section class="grid">

    <div class="col-12 flex justify-content-between items-center mb-4">
        <div>
            <h2 class="font-bold text-2xl mb-4">Gestão de alunos</h2>
            <span class="text-lg">Cadastro e acompanhamento completo dos alunos</span>
        </div>
        <p-button
            label="Novo aluno"
            icon="pi pi-plus"
            class="p-button-outlined"
        ></p-button>
    </div>
    @for (k of kpis; track k) {
        <div [ngClass]="'col-12 md:col-6 xl:col-' + Math.floor(12 / kpis.length)">
            <app-kpi-indicators class="w-full h-full" [kpi]="k"></app-kpi-indicators>
        </div>
    }

    <div class="col-12 flex justify-content-start gap-2 items-center">
        <button pButton pRipple>Lista de alunos</button>
        <button pButton pRipple class="p-button-secondary p-button-text">Relatórios</button>
        <button pButton pRipple class="p-button-secondary p-button-text">Dashboard</button>
    </div>

    <div class="col-12">
        <div class="card">
            <div class="flex gap-2 align-items-center">
                <input
                    pInputText
                    type="text"
                    class="w-full"
                    placeholder="buscar por nome, email, estado"
                />
                <button pButton type="button" label="Filtrar"></button>
            </div>
        </div>
    </div>

    <!-- Student Table -->
    <app-global-table
        tableLabel="Alunos"
        [headerActions]="headerActions"
        [data]="(students$ | async)!"
        [entity]="'students'"
        [columns]="columns"
        [globalFilterFields]="globalFilterFields"
        [loading]="loading$ | async"
        [columnTemplates]="customTemplates"
        (rowSelect)="onRowSelect($event)"
        (createEntity)="navigateToCreateStudent()"
        class="w-full"
    ></app-global-table>
</section>


<!-- Name template field -->
<ng-template #nameTemplate let-rowData>
    <span>{{ rowData.user.firstname + " " + rowData.user.lastname }}   </span>
</ng-template>

<ng-template #phoneTemplate let-rowData>
    <span> {{ rowData.user.phone ?? 'N/A' }} </span>
</ng-template>

<ng-template #emailTemplate let-rowData>
    <span>{{ rowData.user.email }}</span>
</ng-template>


<ng-template #dateOfBirthTemplate let-rowData>
    <span>{{ rowData.user.dateOfBirth ?? 'N/A' }}</span>
</ng-template>

<ng-template #centerTemplate let-rowData>
    <span>{{ getStudentCenter(rowData.centerId) ?? 'N/A' }}</span>
</ng-template>

<ng-template #levelTemplate let-rowData>
    <span> {{ getStudentLevel(rowData.levelId) ?? 'N/A' }} </span>
</ng-template>

<ng-template #classTemplate let-rowData>
    <span> {{ rowData.studentClass?.name ?? 'N/A' }} </span>
</ng-template>

<ng-template #statusTemplate let-rowData>
    <p-badge
        [value]="rowData.status === 'ACTIVE' ? 'Ativo' : 'Inativo'"
        [severity]="rowData.status === 'ACTIVE' ? 'success' : 'danger'"
        class="w-full"
    ></p-badge>
</ng-template>

<ng-template #actionsTemplate let-center>
    <div class="flex gap-2 justify-content-center">
        <button
            pButton
            pRipple
            icon="pi pi-eye"
            class="p-button-rounded p-button-text"
            (click)="navigateToEditStudent(center)"
            pTooltip="Ver Detalhes"
            tooltipPosition="top"
        ></button>
    </div>
</ng-template>
