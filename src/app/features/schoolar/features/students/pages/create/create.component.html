<div class="grid">
    <p-toast></p-toast>
    <div *ngIf="errors$ | async as errors" class="col-12">
        {{ errors | json }}
    </div>

    <div class="col-12">
        <p-card>
            <ng-template pTemplate="title">
                <h2>Adicionar Estudante</h2>
            </ng-template>
            <ng-template pTemplate="content">
                <form [formGroup]="studentForm" (ngSubmit)="saveStudent()">
                    <!-- DADOS PESSOAIS -->
                    <div class="mb-4" formGroupName="personalData">
                        <h3 class="text-900 font-medium text-xl mb-3">Dados Pessoais</h3>
                        <div class="grid p-fluid">
                            <div class="col-12 md:col-4 field">
                                <label for="photo" class="font-bold">Foto</label>
                                <p-fileUpload
                                    mode="basic"
                                    name="photo"
                                    url="./upload.php"
                                    accept="image/*"
                                    [maxFileSize]="1000000"
                                    styleClass="p-button-outlined p-button-plain"
                                    chooseLabel="Carregue uma imagem"
                                    (onSelect)="onPhotoSelect($event)"
                                ></p-fileUpload>
                            </div>
                            <div class="col-12 md:col-4 field">
                                <label for="firstname" class="font-bold">Primeiro nome *</label>
                                <input
                                    id="firstname"
                                    type="text"
                                    pInputText
                                    formControlName="firstname"
                                    [class.ng-invalid]="studentForm.get('personalData.firstname')?.invalid && studentForm.get('personalData.firstname')?.touched"
                                />
                                <small class="p-error"
                                       *ngIf="studentForm.get('personalData.firstname')?.invalid && studentForm.get('personalData.firstname')?.touched">
                                    {{ getFieldError('personalData.firstname') }}
                                </small>
                            </div>

                            <div class="col-12 md:col-4 field">
                                <label for="lastname" class="font-bold">último nome*</label>
                                <input
                                    id="lastname"
                                    type="text"
                                    pInputText
                                    formControlName="lastname"
                                    [class.ng-invalid]="studentForm.get('personalData.lastname')?.invalid && studentForm.get('personalData.lastname')?.touched"
                                />
                                <small class="p-error"
                                       *ngIf="studentForm.get('personalData.lastname')?.invalid && studentForm.get('personalData.lastname')?.touched">
                                    {{ getFieldError('personalData.lastname') }}
                                </small>
                            </div>
                            <div class="col-12 md:col-4 field">
                                <label for="identificationNumber" class="font-bold">Nº de Identificação</label>
                                <input id="identificationNumber" type="text" pInputText
                                       formControlName="identificationNumber"/>
                            </div>
                            <div class="col-12 md:col-4 field">
                                <label for="gender" class="font-bold">Género</label>
                                <p-dropdown
                                    id="gender"
                                    [options]="genderOptions"
                                    formControlName="gender"
                                    optionLabel="label"
                                    optionValue="value"
                                    placeholder="Selecione"
                                    [showClear]="true"
                                ></p-dropdown>
                                <small class="p-error"
                                       *ngIf="studentForm.get('personalData.gender')?.invalid && studentForm.get('personalData.gender')?.touched">
                                    {{ getFieldError('personalData.gender') }}
                                </small>
                            </div>
                            <div class="col-12 md:col-4 field">
                                <label for="dateOfBirth" class="font-bold">Data de Nascimento</label>
                                <p-calendar
                                    id="dateOfBirth"
                                    formControlName="dateOfBirth"
                                    [showIcon]="true"
                                    dateFormat="dd/mm/yy"
                                ></p-calendar>
                                <small class="p-error"
                                       *ngIf="studentForm.get('personalData.dateOfBirth')?.invalid && studentForm.get('personalData.dateOfBirth')?.touched">
                                    {{ getFieldError('personalData.dateOfBirth') }}
                                </small>
                            </div>
                            <div class="col-12 md:col-4 field">
                                <label for="address" class="font-bold">Morada</label>
                                <input id="address" type="text" pInputText formControlName="address"/>
                                <small class="p-error"
                                       *ngIf="studentForm.get('personalData.address')?.invalid && studentForm.get('personalData.address')?.touched">
                                    {{ getFieldError('personalData.address') }}
                                </small>
                            </div>
                            <div class="col-12 md:col-4 field">
                                <label for="phone" class="font-bold">Telefone</label>
                                <input id="phone" type="text" pInputText formControlName="phone"/>
                            </div>
                            <div class="col-12 md:col-8 field">
                                <label for="email" class="font-bold">E-mail</label>
                                <input
                                    id="email"
                                    type="email"
                                    pInputText
                                    formControlName="email"
                                    placeholder="ex. user@gmail.com"
                                    [class.ng-invalid]="studentForm.get('personalData.email')?.invalid && studentForm.get('personalData.email')?.touched"
                                />
                                <small class="p-error"
                                       *ngIf="studentForm.get('personalData.email')?.invalid && studentForm.get('personalData.email')?.touched">
                                    {{ getFieldError('personalData.email') }}
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- DADOS DA MATRICULA -->
                    <div formGroupName="enrollmentData">
                        <h3 class="text-900 font-medium text-xl mb-3">Dados da Matrícula</h3>
                        <div class="grid p-fluid">
                            <div class="col-12 md:col-4 field">
                                <label for="installation" class="font-bold">Centros</label>
                                <p-dropdown
                                    id="installation"
                                    [options]="centers"
                                    formControlName="centerId"
                                    optionLabel="label"
                                    optionValue="value"
                                    placeholder="Selecione"
                                    [showClear]="true"
                                ></p-dropdown>
                            </div>

                            <div class="col-12 md:col-4 field">
                                <label for="registrationType" class="font-bold">Nível</label>
                                <p-dropdown
                                    id="registrationType"
                                    [options]="levels"
                                    formControlName="levelId"
                                    optionLabel="label"
                                    optionValue="value"
                                    placeholder="Selecione"
                                    [showClear]="true"
                                ></p-dropdown>
                            </div>

                            <div class="col-12 md:col-4 field">
                                <label for="status" class="font-bold">Estado</label>
                                <p-dropdown
                                    id="status"
                                    [options]="statusOptions"
                                    formControlName="status"
                                    optionLabel="label"
                                    optionValue="value"
                                    placeholder="Selecione"
                                    [showClear]="true"
                                ></p-dropdown>
                            </div>

                            <div class="col-12 field">
                                <label for="observations" class="font-bold">Observações</label>
                                <textarea
                                    id="observations"
                                    rows="5"
                                    formControlName="observations"
                                    placeholder="Observações"
                                    pInputTextarea
                                ></textarea>
                            </div>
                        </div>
                    </div>
                </form>
            </ng-template>
            <ng-template pTemplate="footer">
                <div class="flex justify-content-end">
                    <button pButton label="Cancelar" icon="pi pi-times" class="p-button-text mr-2"
                            type="button"></button>
                    <button
                        pButton
                        label="{{(loading$ | async) ? 'Salvando...' : 'Adicionar Estudante'}}"
                        icon="pi pi-check"
                        (click)="saveStudent()"
                        type="button"
                        [disabled]="studentForm.invalid"
                    ></button>
                </div>
            </ng-template>
        </p-card>
    </div>
</div>
