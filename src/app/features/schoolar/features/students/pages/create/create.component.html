<div class="grid">
    <div class="col-12">
        <p-card>
            <ng-template pTemplate="title">
                <h2>Adicionar Estudante</h2>
            </ng-template>
            <ng-template pTemplate="content">
                <!-- Stepper -->
                <div class="mb-5">
                    <p-steps [model]="steps" [activeIndex]="activeIndex" [readonly]="false" (activeIndexChange)="goToStep($event)" styleClass="mt-2"></p-steps>
                </div>

                <!-- Progress indicator -->
                <div class="text-center mb-4">
                    <span class="text-600">Passo {{activeIndex + 1}} de {{steps.length}}</span>
                </div>

                <!-- Step 1: DADOS PESSOAIS -->
                <div *ngIf="activeIndex === 0" class="step-content">
                    <h3 class="text-900 font-medium text-xl mb-3">Dados Pessoais</h3>
                    <div class="grid p-fluid">
                        <div class="col-12 md:col-4 field">
                            <label for="photo" class="font-bold">Foto</label>
                            <p-fileUpload
                                mode="basic"
                                name="photo"
                                url="./upload.php"
                                accept="image/*"
                                [maxFileSize]="1000000"
                                styleClass="p-button-outlined p-button-plain"
                                chooseLabel="Carregue uma imagem"
                                [(ngModel)]="student.personalData.photo"
                            ></p-fileUpload>
                        </div>
                        <div class="col-12 md:col-8 field">
                            <label for="fullName" class="font-bold">Nome Completo</label>
                            <input id="fullName" type="text" pInputText [(ngModel)]="student.personalData.fullName" required />
                        </div>

                        <div class="col-12 md:col-4 field">
                            <label for="idType" class="font-bold">Tipo de Identificação</label>
                            <p-dropdown
                                id="idType"
                                [options]="idTypes"
                                [(ngModel)]="student.personalData.idType"
                                optionLabel="label"
                                placeholder="Selecione"
                                [showClear]="true"
                            ></p-dropdown>
                        </div>
                        <div class="col-12 md:col-4 field">
                            <label for="idNumber" class="font-bold">Nº de Identificação</label>
                            <input id="idNumber" type="text" pInputText [(ngModel)]="student.personalData.idNumber" />
                        </div>
                        <div class="col-12 md:col-4 field">
                            <label for="country" class="font-bold">País</label>
                            <p-dropdown
                                id="country"
                                [options]="countries"
                                [(ngModel)]="student.personalData.country"
                                optionLabel="name"
                                [filter]="true"
                                filterBy="name"
                                [showClear]="true"
                                placeholder="Selecione um país"
                            >
                                <ng-template let-country pTemplate="item">
                                    <div class="flex align-items-center">
                                        <img
                                            src="assets/demo/images/flag/flag_placeholder.png"
                                            [class]="'mr-2 flag flag-' + country.code.toLowerCase()"
                                            style="width: 18px"
                                        />
                                        <div>{{ country.name }}</div>
                                    </div>
                                </ng-template>
                            </p-dropdown>
                        </div>
                        <div class="col-12 md:col-4 field">
                            <label for="gender" class="font-bold">Género</label>
                            <p-dropdown
                                id="gender"
                                [options]="genderOptions"
                                [(ngModel)]="student.personalData.gender"
                                optionLabel="label"
                                placeholder="Selecione"
                                [showClear]="true"
                            ></p-dropdown>
                        </div>
                        <div class="col-12 md:col-4 field">
                            <label for="birthDate" class="font-bold">Data de Nascimento</label>
                            <p-calendar
                                id="birthDate"
                                [(ngModel)]="student.personalData.birthDate"
                                [showIcon]="true"
                                dateFormat="dd/mm/yy"
                            ></p-calendar>
                        </div>
                        <div class="col-12 md:col-4 field">
                            <label for="address" class="font-bold">Morada</label>
                            <input id="address" type="text" pInputText [(ngModel)]="student.personalData.address" />
                        </div>
                        <div class="col-12 md:col-8 field">
                            <label for="email" class="font-bold">E-mail</label>
                            <input
                                id="email"
                                type="email"
                                pInputText
                                [(ngModel)]="student.personalData.email"
                                placeholder="ex. user@gmail.com"
                            />
                        </div>
                    </div>
                </div>

                <!-- Step 2: DADOS ACADÊMICOS -->
                <div *ngIf="activeIndex === 1" class="step-content">
                    <h3 class="text-900 font-medium text-xl mb-3">Dados Acadêmicos</h3>
                    <div class="grid p-fluid">
                        <div class="col-12 md:col-4 field">
                            <label for="installation" class="font-bold">Instalação</label>
                            <p-dropdown
                                id="installation"
                                [options]="installations"
                                [(ngModel)]="student.academicData.installation"
                                optionLabel="label"
                                placeholder="Selecione"
                                [showClear]="true"
                            ></p-dropdown>
                        </div>

                        <div class="col-12 md:col-4 field">
                            <label for="registrationType" class="font-bold">Tipo de Inscrição</label>
                            <p-dropdown
                                id="registrationType"
                                [options]="levels"
                                [(ngModel)]="student.academicData.registrationType"
                                optionLabel="label"
                                placeholder="Selecione"
                                [showClear]="true"
                            ></p-dropdown>
                        </div>

                        <div class="col-12 md:col-4 field">
                            <label for="status" class="font-bold">Estado</label>
                            <p-dropdown
                                id="status"
                                [options]="statusOptions"
                                [(ngModel)]="student.academicData.status"
                                optionLabel="label"
                                placeholder="Selecione"
                                [showClear]="true"
                            ></p-dropdown>
                        </div>

                        <div class="col-12 md:col-8 field">
                            <label for="entity" class="font-bold">Entidades</label>
                            <p-dropdown
                                id="entity"
                                [options]="entities"
                                [(ngModel)]="student.academicData.entity"
                                optionLabel="label"
                                placeholder="Selecione"
                                [showClear]="true"
                            ></p-dropdown>
                        </div>

                        <div class="col-12 md:col-4 field">
                            <label for="discount" class="font-bold">Descontos Automáticos</label>
                            <p-dropdown
                                id="discount"
                                [options]="discounts"
                                [(ngModel)]="student.academicData.automaticDiscount"
                                optionLabel="label"
                                placeholder="Selecione"
                                [showClear]="true"
                            ></p-dropdown>
                        </div>

                        <div class="col-12 md:col-6 field">
                            <label for="paymentMethod" class="font-bold">Modalidade de Pagamento</label>
                            <p-dropdown
                                id="paymentMethod"
                                [options]="paymentMethods"
                                [(ngModel)]="student.academicData.paymentMethod"
                                optionLabel="label"
                                placeholder="Selecione"
                                [showClear]="true"
                            ></p-dropdown>
                        </div>
                        <div class="col-12 md:col-6 field">
                            <label for="monthlyReference" class="font-bold">Mensalidade por Referência Multibanco</label>
                            <p-dropdown
                                id="monthlyReference"
                                [options]="referenceOptions"
                                [(ngModel)]="student.academicData.monthlyReference"
                                optionLabel="label"
                                placeholder="Selecione"
                                [showClear]="true"
                            ></p-dropdown>
                        </div>

                        <div class="col-12">
                            <div class="grid">
                                <div class="col-12 md:col-6 field-checkbox mb-3">
                                    <p-checkbox
                                        name="responsibility"
                                        [binary]="true"
                                        [(ngModel)]="student.academicData.termsAccepted.responsibility"
                                        id="responsibility"
                                    ></p-checkbox>
                                    <label for="responsibility" class="ml-2">Termos de Responsabilidades</label>
                                </div>

                                <div class="col-12 md:col-6 field-checkbox mb-3">
                                    <p-checkbox
                                        name="communication"
                                        [binary]="true"
                                        [(ngModel)]="student.academicData.termsAccepted.communication"
                                        id="communication"
                                    ></p-checkbox>
                                    <label for="communication" class="ml-2">
                                        Aceita receber comunicação sobre o funcionamento e alterações
                                    </label>
                                </div>

                                <div class="col-12 md:col-6 field-checkbox mb-3">
                                    <p-checkbox
                                        name="emailMarketing"
                                        [binary]="true"
                                        [(ngModel)]="student.academicData.termsAccepted.emailMarketing"
                                        id="emailMarketing"
                                    ></p-checkbox>
                                    <label for="emailMarketing" class="ml-2">
                                        Aceita receber informações por email (Publicidade)
                                    </label>
                                </div>

                                <div class="col-12 md:col-6 field-checkbox mb-3">
                                    <p-checkbox
                                        name="dataProcessing"
                                        [binary]="true"
                                        [(ngModel)]="student.academicData.termsAccepted.dataProcessing"
                                        id="dataProcessing"
                                    ></p-checkbox>
                                    <label for="dataProcessing" class="ml-2">
                                        Aceita a recolha e tratamento dos dados pessoais
                                    </label>
                                </div>

                                <div class="col-12 md:col-6 field-checkbox mb-3">
                                    <p-checkbox
                                        name="emailInvoices"
                                        [binary]="true"
                                        [(ngModel)]="student.academicData.termsAccepted.emailInvoices"
                                        id="emailInvoices"
                                    ></p-checkbox>
                                    <label for="emailInvoices" class="ml-2">Receber facturas por e-mail</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: CONTATO DE EMERGÊNCIA -->
                <div *ngIf="activeIndex === 2" class="step-content">
                    <h3 class="text-900 font-medium text-xl mb-3">Contato de Emergência</h3>
                    <div class="grid p-fluid">
                        <div class="col-12 md:col-6 field">
                            <label for="emergencyName" class="font-bold">Nome</label>
                            <input id="emergencyName" type="text" pInputText [(ngModel)]="student.emergencyContact.name" required />
                        </div>
                        <div class="col-12 md:col-6 field">
                            <label for="emergencyRelationship" class="font-bold">Relação</label>
                            <input id="emergencyRelationship" type="text" pInputText [(ngModel)]="student.emergencyContact.relationship" />
                        </div>
                        <div class="col-12 md:col-6 field">
                            <label for="emergencyPhone" class="font-bold">Telefone</label>
                            <input id="emergencyPhone" type="text" pInputText [(ngModel)]="student.emergencyContact.phone" required />
                        </div>
                        <div class="col-12 md:col-6 field">
                            <label for="emergencyEmail" class="font-bold">E-mail</label>
                            <input id="emergencyEmail" type="email" pInputText [(ngModel)]="student.emergencyContact.email" placeholder="ex. contact@gmail.com" />
                        </div>
                        <div class="col-12 field">
                            <label for="emergencyAddress" class="font-bold">Morada</label>
                            <input id="emergencyAddress" type="text" pInputText [(ngModel)]="student.emergencyContact.address" />
                        </div>
                    </div>
                </div>

                <!-- Step 4: OBSERVAÇÕES -->
                <div *ngIf="activeIndex === 3" class="step-content">
                    <h3 class="text-900 font-medium text-xl mb-3">Observações</h3>
                    <div class="grid p-fluid">
                        <div class="col-12 field">
                            <label for="observations" class="font-bold">Observações</label>
                            <textarea
                                id="observations"
                                rows="5"
                                [(ngModel)]="student.observations"
                                placeholder="Observações"
                                pInputTextarea
                            ></textarea>
                        </div>
                    </div>
                </div>

                <!-- Step Navigation Buttons -->
                <div class="flex justify-content-between mt-4">
                    <button
                        pButton
                        label="Anterior"
                        icon="pi pi-arrow-left"
                        class="p-button-secondary"
                        (click)="prevStep()"
                        [disabled]="activeIndex === 0"
                    ></button>
                    <button
                        *ngIf="activeIndex < 3"
                        pButton
                        label="Próximo"
                        icon="pi pi-arrow-right"
                        iconPos="right"
                        (click)="nextStep()"
                    ></button>
                    <button
                        *ngIf="activeIndex === 3"
                        pButton
                        label="Finalizar"
                        icon="pi pi-check"
                        (click)="saveStudent()"
                    ></button>
                </div>
            </ng-template>
            <ng-template pTemplate="footer">
                <div class="flex justify-content-end">
                    <button pButton label="Cancelar" icon="pi pi-times" class="p-button-text mr-2"></button>
                </div>
            </ng-template>
        </p-card>
    </div>
</div>
