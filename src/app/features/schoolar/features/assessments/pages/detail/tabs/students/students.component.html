<div class="card">
    <div class="flex justify-content-between align-items-center mb-4">
        <h2 class="text-xl font-semibold flex align-items-center">
            <i class="pi pi-users text-blue-500 mr-2"></i>
            Estudantes Avaliados
        </h2>
        <div class="flex align-items-center gap-2">
            <p-tag [value]="'Total: ' + students.length" severity="info"></p-tag>
            <p-tag [value]="'Presentes: ' + getPresentCount()" severity="success"></p-tag>
            <p-tag [value]="'Ausentes: ' + getAbsentCount()" severity="danger"></p-tag>
        </div>
    </div>

    <p-table [value]="students" [tableStyle]="{'min-width': '60rem'}" [paginator]="true" [rows]="10"
             styleClass="p-datatable-gridlines" [showCurrentPageReport]="true"
             currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} estudantes"
             [globalFilterFields]="['name', 'email']">

        <ng-template pTemplate="caption">
            <div class="flex justify-content-between align-items-center">
                <span class="text-900 text-lg font-medium">Lista de Estudantes</span>
                <div class="flex gap-2">
                    <button pButton pRipple label="Exportar" icon="pi pi-download"
                            class="p-button-outlined p-button-sm"></button>
                    <button pButton pRipple label="Adicionar Estudante" icon="pi pi-plus"
                            class="p-button-sm"></button>
                </div>
            </div>
        </ng-template>

        <ng-template pTemplate="header">
            <tr>
                <th style="width: 4rem">Avatar</th>
                <th>Nome</th>
                <th>Email</th>
                <th>Presença</th>
                <th>Pontuação</th>
                <th>Performance</th>
                <th style="width: 8rem">Ações</th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-student>
            <tr>
                <td>
                    <p-avatar [label]="student.name.charAt(0)"
                             styleClass="mr-2"
                             size="normal"
                             shape="circle"
                             [style]="{'background-color':'#dee2e6', 'color': '#495057'}"></p-avatar>
                </td>
                <td>
                    <div>
                        <div class="text-900 font-medium">{{ student.name }}</div>
                        <div class="text-600 text-sm">ID: {{ student.id }}</div>
                    </div>
                </td>
                <td>{{ student.email }}</td>
                <td>
                    <p-tag [value]="student.attendance"
                           [severity]="student.attendance === 'Present' ? 'success' : 'danger'"
                           [icon]="student.attendance === 'Present' ? 'pi pi-check' : 'pi pi-times'">
                    </p-tag>
                </td>
                <td>
                    <div class="text-900 font-bold text-lg">{{ student.score }}%</div>
                </td>
                <td>
                    <div class="flex align-items-center gap-2">
                        <p-progressBar [value]="student.score" [showValue]="false"
                                      [style]="{'width': '100px', 'height': '8px'}"
                                      [class]="'progress-' + (student.score >= 70 ? 'success' : student.score >= 50 ? 'warning' : 'danger')"></p-progressBar>
                        <p-tag [value]="student.score >= 90 ? 'Excelente' :
                                       student.score >= 80 ? 'Bom' :
                                       student.score >= 70 ? 'Satisfatório' : 'Precisa Melhorar'"
                               [severity]="student.score >= 70 ? 'success' : student.score >= 50 ? 'warning' : 'danger'"
                               class="text-xs"></p-tag>
                    </div>
                </td>
                <td>
                    <div class="flex gap-1">
                        <button pButton pRipple icon="pi pi-eye"
                                class="p-button-rounded p-button-text p-button-sm"
                                pTooltip="Ver Detalhes" tooltipPosition="top"></button>
                        <button pButton pRipple icon="pi pi-pencil"
                                class="p-button-rounded p-button-text p-button-sm"
                                pTooltip="Editar Avaliação" tooltipPosition="top"></button>
                        <button pButton pRipple icon="pi pi-file-pdf"
                                class="p-button-rounded p-button-text p-button-sm"
                                pTooltip="Gerar Relatório" tooltipPosition="top"></button>
                    </div>
                </td>
            </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="7" class="text-center p-6">
                    <div class="flex flex-column align-items-center gap-3">
                        <i class="pi pi-users text-4xl text-400"></i>
                        <div class="text-900 font-medium text-lg">Nenhum estudante encontrado</div>
                        <div class="text-600">Não há estudantes registrados para esta avaliação.</div>
                        <button pButton pRipple label="Adicionar Estudantes" icon="pi pi-plus" class="p-button-sm"></button>
                    </div>
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>
